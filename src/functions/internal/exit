# Exit and cleanup file used by airoscript
# Copyright (C) 2010-2011 David Francos Cuartero
#        This program is free software; you can redistribute it and/or
#        modify it under the terms of the GNU General Public License
#        as published by the Free Software Foundation; either version 2
#        of the License, or (at your option) any later version.

#        This program is distributed in the hope that it will be useful,
#        but WITHOUT ANY WARRANTY; without even the implied warranty of
#        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#        GNU General Public License for more details.

#        You should have received a copy of the GNU General Public License
#        along with this program; if not, write to the Free Software

delete_vinterfaces(){ for i in $(awk '/airoscript/ {print $1}' <(airmon-ng)); do iw dev $i del; done; }
deconfigure(){ airmon-ng stop $wifi &> /dev/null ; delete_vinterfaces &>/dev/null; }
delete_dpath(){ grep "tmp" <<< $DUMP_PATH && rm -r $DUMP_PATH &2>/dev/null;  }

doexit(){
        yesno "Do you want me to stop monitor mode on $wifi and delete virtual interfaces? (Y/n) " && { warn "${mark}Cleaning interface"; deconfigure; }
        yesno 'Do you want me to delete temporary data dir? (y/N) ' && { warn "${mark}Deleting $DUMP_PATH"; delete_dpath; }
        [[ "$1" == "killme" ]] && pkill air $$ || exit # Needed because of autopwn
}
